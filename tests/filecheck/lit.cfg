import lit.formats
import os
import sys

python_path = os.path.abspath(os.getcwd())

lit_config.saveTestTimes = False

def get_filecheck_command(test_path):
    if test_path.endswith(".py"):
        return "FileCheck --implicit-check-not='#'"
    return "FileCheck"

config.test_source_root = os.path.dirname(__file__)
tt_src = os.path.dirname(os.path.dirname(config.test_source_root))
config.test_exec_root = tt_src


config.name = "Tenstorrent"
config.test_format = lit.formats.ShTest(preamble_commands=[f"cd {tt_src}", f"export PYTHONPATH={python_path}"])
config.suffixes = ['.mlir', '.py']

tt_opt = "tenstorrent/tools/tt-opt"

config.substitutions.append(("%FileCheck", get_filecheck_command("%s")))
